<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - DairyPro Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- Authentication Check Script -->
    <script>
        // Check authentication immediately when page loads
        if (localStorage.getItem('isAuthenticated') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>

    <div class="flex h-screen bg-gray-100">
        <!-- Sidebar Navigation -->
        <div class="w-64 sidebar text-white flex flex-col fixed h-full z-10">
            <div class="px-6 py-5 border-b border-blue-700">
                <h2 class="text-2xl font-bold flex items-center">
                    <i class="fas fa-cow mr-3 text-blue-200"></i> 
                    <span class="bg-gradient-to-r from-blue-100 to-blue-200 bg-clip-text text-transparent">DairyPro</span>
                </h2>
                <p class="text-blue-200 text-sm mt-1">Management System</p>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-1">
                <a href="index.html" class="sidebar-link active flex items-center px-4 py-3">
                    <i class="fas fa-tachometer-alt"></i> 
                    <span>Dashboard</span>
                </a>
                <a href="farmers.html" class="sidebar-link flex items-center px-4 py-3">
                    <i class="fas fa-users"></i> 
                    <span>Farmers</span>
                </a>
                <a href="delivery.html" class="sidebar-link flex items-center px-4 py-3">
                    <i class="fas fa-truck"></i> 
                    <span>Record Delivery</span>
                </a>
                <a href="debit.html" class="sidebar-link flex items-center px-4 py-3">
                    <i class="fas fa-minus-circle"></i> 
                    <span>Record Debit</span>
                </a>
                <a href="payment.html" class="sidebar-link flex items-center px-4 py-3">
                    <i class="fas fa-money-bill-wave"></i> 
                    <span>Record Payment</span>
                </a>
                <a href="analytics.html" class="sidebar-link flex items-center px-4 py-3">
                    <i class="fas fa-chart-line"></i> 
                    <span>Analytics</span>
                </a>
                <a href="transactions.html" class="sidebar-link flex items-center px-4 py-3">
                    <i class="fas fa-exchange-alt"></i> 
                    <span>Transactions</span>
                </a>
                <a href="reports.html" class="sidebar-link flex items-center px-4 py-3">
                    <i class="fas fa-file-alt"></i> 
                    <span>Reports</span>
                </a>
                <a href="profile.html" class="sidebar-link flex items-center px-4 py-3">
                    <i class="fas fa-building"></i> 
                    <span>Profile</span>
                </a>
                <a href="#" class="sidebar-link flex items-center px-4 py-3 mt-4" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> 
                    <span>Logout</span>
                </a>
            </nav>
            <div class="px-6 py-4 border-t border-blue-700 text-sm text-blue-200">
                <p>Â© 2025 DairyPro Management</p>
            </div>
        </div>

        <div class="flex-1 flex flex-col overflow-hidden ml-64">
            <header class="main-header p-4">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-tachometer-alt mr-3 text-indigo-500"></i> 
                        Dashboard
                    </h1>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition">
                                <i class="fas fa-bell text-gray-600"></i>
                                <span class="notification-badge">3</span>
                            </button>
                        </div>
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white font-semibold">
                                A
                            </div>
                            <span class="ml-2 text-gray-700 font-medium">Admin</span>
                        </div>
                    </div>
                </div>
            </header>
            
            <main class="flex-1 overflow-x-hidden overflow-y-auto p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="summary-card bg-white p-6 card-blue">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-gray-600 text-sm font-medium flex items-center">
                                    <i class="fas fa-tint mr-2 text-blue-500"></i> 
                                    Total Milk Today
                                </h3>
                                <p id="total-milk-today" class="text-3xl font-bold text-gray-800 mt-2">0 L</p>
                            </div>
                            <div class="p-3 rounded-lg bg-blue-50 text-blue-500">
                                <i class="fas fa-tint text-xl"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-4">+12% from yesterday</p>
                    </div>
                    
                    <div class="summary-card bg-white p-6 card-green">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-gray-600 text-sm font-medium flex items-center">
                                    <i class="fas fa-users mr-2 text-green-500"></i> 
                                    Total Farmers
                                </h3>
                                <p id="total-farmers" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                            </div>
                            <div class="p-3 rounded-lg bg-green-50 text-green-500">
                                <i class="fas fa-users text-xl"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-4">Active this month</p>
                    </div>
                    
                    <div class="summary-card bg-white p-6 card-red">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-gray-600 text-sm font-medium flex items-center">
                                    <i class="fas fa-exclamation-triangle mr-2 text-red-500"></i> 
                                    Total Outstanding
                                </h3>
                                <p id="total-debits" class="text-3xl font-bold text-red-600 mt-2">0 Rwf</p>
                            </div>
                            <div class="p-3 rounded-lg bg-red-50 text-red-500">
                                <i class="fas fa-exclamation-triangle text-xl"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-4">Across all farmers</p>
                    </div>
                    
                    <div class="summary-card bg-white p-6 card-purple">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-gray-600 text-sm font-medium flex items-center">
                                    <i class="fas fa-balance-scale mr-2 text-purple-500"></i> 
                                    Net Balance
                                </h3>
                                <p id="net-balance-all-time" class="text-3xl font-bold text-indigo-600 mt-2">0 Rwf</p>
                            </div>
                            <div class="p-3 rounded-lg bg-purple-50 text-purple-500">
                                <i class="fas fa-balance-scale text-xl"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-4">All time balance</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-cog mr-2 text-indigo-500"></i> 
                            System Settings
                        </h3>
                        <div class="flex items-center space-x-4">
                            <div>
                                <label for="price-per-litre" class="font-medium text-gray-700">Price per Litre (Rwf):</label>
                                <input type="number" id="price-per-litre" step="1" class="form-input w-32 px-4 py-2 mt-1">
                            </div>
                            <button onclick="saveSettings()" class="btn btn-primary mt-6 py-2 px-6">
                                <i class="fas fa-save mr-2"></i> Save
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-clock mr-2 text-indigo-500"></i> 
                            Recent Activity
                        </h3>
                        <div class="space-y-3">
                            <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-500 mr-3">
                                    <i class="fas fa-truck text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-medium">New milk delivery recorded</p>
                                    <p class="text-xs text-gray-500">John Musole - 45.5L</p>
                                </div>
                                <span class="ml-auto text-xs text-gray-500">2 hours ago</span>
                            </div>
                            
                            <div class="flex items-center p-3 bg-green-50 rounded-lg">
                                <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-500 mr-3">
                                    <i class="fas fa-money-bill-wave text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-medium">Payment received</p>
                                    <p class="text-xs text-gray-500">Aline Zawadi - 25,000 Rwf</p>
                                </div>
                                <span class="ml-auto text-xs text-gray-500">5 hours ago</span>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="app.js"></script>
    
    <!-- Remove or comment out Firebase script if not needed for authentication -->
    <!--
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDweCLpw-tFx9cm5xCs4WlZh_N8gvls2to",
            authDomain: "studio-3904406673-cf577.firebaseapp.com",
            projectId: "studio-3904406673-cf577",
            storageBucket: "studio-3904406673-cf577.firebasestorage.app",
            messagingSenderId: "542266737931",
            appId: "1:542266737931:web:39b7befdfadb81f2454e0e"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
    </script>
    -->

    <script>
        function initDashboard() {
            renderDashboard();
        }

        function renderDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const milkToday = milkDeliveries
                .filter(d => d.date === today)
                .reduce((sum, d) => sum + (d.litresMorning || 0) + (d.litresNight || 0), 0);
            
            const totalDebits = farmerDebits.reduce((sum, d) => sum + d.amount, 0);
            
            const aggregateNetBalance = farmers.reduce((sum, f) => sum + calculateFarmerBalance(f.id), 0);

            document.getElementById('total-milk-today').textContent = formatLitres(milkToday);
            document.getElementById('total-farmers').textContent = farmers.length;
            document.getElementById('total-debits').textContent = formatCurrency(totalDebits);
            document.getElementById('price-per-litre').value = settings.pricePerLitre;
            
            const netBalanceElement = document.getElementById('net-balance-all-time');
            netBalanceElement.textContent = formatCurrency(aggregateNetBalance);
            netBalanceElement.classList.remove('text-indigo-600', 'text-red-500', 'text-green-600');
            netBalanceElement.classList.add(aggregateNetBalance >= 0 ? 'text-indigo-600' : 'text-red-500');
        }

        function saveSettings() {
            settings.pricePerLitre = parseFloat(document.getElementById('price-per-litre').value) || 0;
            saveAllData();
            
            // Show success feedback
            const btn = document.querySelector('button[onclick="saveSettings()"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<div class="spinner"></div> Saving...';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
                renderDashboard();
                showToast('Settings saved successfully!', 'success');
            }, 800);
        }

        // Enhanced logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear all authentication data
                localStorage.removeItem('isAuthenticated');
                localStorage.removeItem('username');
                localStorage.removeItem('userEmail');
                
                // Redirect to login page
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>